# Stock Insights AI Agent
**TL;DR**: LangChain-inspired AI Agent functioning as a complex RAG pipeline producing a single, actionable stock insight report
## üöÄ Try the Agent
‚û°Ô∏è Web App: [https://armaanwadhwa09.github.io/Stock-Insight-AI-Agent-Frontend/ ](https://armaanwadhwa09.github.io/Stock-Insight-AI-Agent-Frontend/) <br> <br>
> ‚ö†Ô∏è Note: The agent runs on a **subscription-based n8n Cloud workflow**.  
> It may stop functioning once the subscription or workflow instance is deactivated.  
> Even if the live agent becomes unavailable, this repository includes:
> - A complete **demo video** of the agent running end-to-end  
> - The full **source code** for the frontend  
> - A detailed **n8n architecture diagram**  
> - The **workflow JSON export** for reference  

You can still explore the full codebase, reasoning chain, and RAG-based architecture here on GitHub.<br><br>
‚û°Ô∏è Demo Video: [Stock Insight AI Agent Demo](https://drive.google.com/file/d/1uBZXiz9LZj2dPAy0bUF5U5HD1NP3W8fj/view?usp=share_link)

*(No installation needed - stock report directly in your mail)*
1. Enter a stock ticker (e.g. `AAPL`)  
2. Add your email address  
3. The agent runs asynchronously via n8n and emails you a complete, data-driven analysis
---
## Repository Structure
```
stock-insight-ai-agent/
‚îú‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ n8n_workflow/
‚îÇ   ‚îú‚îÄ‚îÄ demo_video.md             # Demo video with process flow
‚îÇ   ‚îú‚îÄ‚îÄ workflow_export.js        # Exported n8n workflow (backend logic)
‚îÇ   ‚îú‚îÄ‚îÄ architecture_diagram.png  # RAG architecture visualization
‚îÇ   ‚îî‚îÄ‚îÄ Output Data               # Example Output for AMZN (26/10/2025)
‚îÇ
‚îî‚îÄ‚îÄ Code_Nodes/
    ‚îú‚îÄ‚îÄ Code_Cleaner_1.js         # All the codes to clean api pulls into structured data
    ‚îú‚îÄ‚îÄ Code_Cleaner_2.js
    ‚îú‚îÄ‚îÄ Code_Cleaner_3.js
    ‚îú‚îÄ‚îÄ Code_Cleaner_4.js
    ‚îú‚îÄ‚îÄ Code_Cleaner_5.js
    ‚îú‚îÄ‚îÄ Code_Cleaner_6.js
    ‚îú‚îÄ‚îÄ Code_Cleaner_7.js
    ‚îú‚îÄ‚îÄ Code_Cleaner_8.js
    ‚îú‚îÄ‚îÄ Consolidation.js          # Combines all cleaned data into one structured context
    ‚îî‚îÄ‚îÄ prompt_orchestration.js   # Defines reasoning chain and LLM orchestration
```
---
## Tables of Contents 
- [Introduction](#Introduction)
- [Architecture Diagram](#architecture-diagram)
- [The Brain (LLM Reasoning Engine)](#the-brain-llm-reasoning-engine)
- [Memory (Context & Data Fusion)](#memory-context--data-fusion)
- [Tools (Retrieval & APIs)](#tools-retrieval--apis)
- [LangChain Framework](#langchain-framework)
- [Architecture Design](#architecture-design)
- [Frontend (GitHub Pages)](#frontend-github-pages)
---
## Introduction
**Stock Insight AI Agent** is a LangChain-style RAG (Retrieval-Augmented Generation) workflow built with **n8n** and **OpenAI GPT models**.  
It behaves like a financial analyst: pulling live market data, assessing fundamentals, detecting insider trends, and delivering a grounded investment brief.
Unlike a basic LLM prompt, this agent:
1. Retrieves **real-world data** via tools (APIs)
2. Performs **data normalization & synthesis**
3. Runs a **multi-step reasoning chain**
4. Outputs a **grounded, structured investment report**
---
## Architecture Diagram
![Architecture Diagram](https://github.com/ArmaanWadhwa09/Stock-Insights-AI-Agent/blob/main/n8n_workflow/Architecture_Diagram.png?raw=true)
---
## The Brain (LLM Reasoning Engine)
At its core lies an OpenAI LLM node responsible for **guided reasoning**:
- Executes a multi-step **Reasoning Chain** defined as below
- Interprets structured financial context generated by upstream data nodes
- Produces a **grounded report** where every insight maps back to retrieved data
This design separates *reasoning* from *retrieval*, ensuring factual consistency and repeatability.<br>
#### **Reasoning Chain**
1. DATA SYNTHESIS: Review all provided data sources (market data, financials, sentiment, insider activity)
2. FINANCIAL HEALTH ASSESSMENT: Evaluate profitability, liquidity, debt levels, and cash generation
3. VALUATION ANALYSIS: Assess if the stock is overvalued, fairly valued, or undervalued based on ratios
4. GROWTH TRAJECTORY: Analyze growth trends in assets, revenue indicators, and operational metrics
5. RISK IDENTIFICATION: Identify key risks from debt levels, insider selling, negative sentiment, or market conditions
6. OPPORTUNITY IDENTIFICATION: Highlight positive signals like strong cash flow, insider buying, positive sentiment
7. SENTIMENT SYNTHESIS: Aggregate market sentiment from news and social sources
8. FINAL RECOMMENDATION: Provide a clear investment thesis with key drivers and risks
---
## Memory (Context & Data Fusion)
In this financial AI Agent, ‚Äúmemory‚Äù means contextual awareness and not a long-term database. Because market data changes quickly, the agent only keeps what‚Äôs needed for the current analysis.

1. <ins>Operational Memory (The Context Key)</ins>

**What it is:** The agent‚Äôs short-term memory that carries the main user request (the stock ticker and email) through the whole workflow.<br> <br>
**How it works:** When you enter a ticker and email, the Webhook node captures them and passes them to all eight API calls. Every tool the agent uses knows which stock to analyze and where to send the final report.<br><br>
**Why it matters:** This memory keeps the workflow consistent and ensures all results stay focused on the same company.<br><br>

2. <ins>In-Context Memory (The RAG Context)</ins>

**What it is:** A single, merged data summary that the AI model uses to make its final decisions.<br><br>
**How it works:** The Data Aggregator Code Node combines cleaned data from all eight sources (Yahoo Finance, FMP Ratios, Insider Activity, etc.) into one text block called structuredData.<br><br>
**Why it matters:**This compact text gives the model all the key numbers and facts at once, so it can reason and generate a grounded, accurate report. This is the ‚Äúretrieval‚Äù part of the RAG (Retrieval-Augmented Generation) process.<br><br>

3. <ins>Procedural Memory (The Agent‚Äôs Blueprint)</ins>

**What it is:** The agent‚Äôs internal ‚Äúinstructions‚Äù so how it thinks, analyzes, and explains.<br><br>
**How it works:** A Code Node defines a multi-step Reasoning Chain, telling the AI how to move through the analysis framework (profitability ‚Üí liquidity ‚Üí valuation ‚Üí risk, etc.).<br><br>
**Why it matters:** This gives the AI structure and discipline. It follows a guided thought process to produce a reliable financial analysis.<br><br>

---
## Tools (Retrieval & APIs)
The agent invokes multiple tools in parallel ‚Äî forming the **Retrieval** part of RAG:
| API | Purpose |
|-----|----------|
| Yahoo Finance | Real-time price & volume |
| FMP TTM Ratios | Profitability, valuation, growth metrics |
| FMP Balance Sheet | Total assets and liabilities |
| Finnhub Insider Trading | insider buy/sell data |
| StockNews Sentiment | Market tone & chatter |
| FMP Balance Sheet Growth | Asset and debt growth trends |
| FMP Company Profile | Industry and company profile |
| FMP Cash Flow | Operating cash flow metrics |

Each tool call happens in a dedicated HTTP node, making retrieval parallelized and error prone.

---
## LangChain Framework
While this isn‚Äôt a Python LangChain implementation, it mirrors LangChain‚Äôs **Agentic Design Pattern** using n8n:
| LangChain Concept | n8n Equivalent |
|--------------------|----------------|
| Tool | HTTP Request Node |
| Memory | Consolidation Code Node |
| Chain | Sequential Node Flow |
| Agent | The full orchestrated workflow |
| PromptTemplate | Code Node that constructs LLM input |

---
## Architecture Design
**I. INGESTION AND DECOUPLED ARCHITECTURE**

- Node: Webhook
  - Action: Receives the user's POST request {"ticker": "AAPL", "email": "user@example.com"}.

- Node: Respond to Webhook

**II. PARALLEL DATA RETRIEVAL (TOOL INVOCATION)**

The workflow splits into eight parallel paths. Each path fetches data from a dedicated external API ("Tool").

- HTTP Request (Yahoo): Fetches Current Price and Volume (Technical Data).
- HTTP Request (FMP TTM Ratios): Fetches P/E, Margins, and Liquidity Ratios (Valuation Data).
- HTTP Request (FMP Balance Sheet): Fetches Total Assets and Liabilities (Fundamental Data).
- HTTP Request (FMP Cash Flow): Fetches Operating Cash Flow (Fundamental Data).
- HTTP Request (FMP Balance Growth): Fetches Asset and Debt Growth Trends (Fundamental Data).
- HTTP Request (FMP Profile/Company): Fetches Industry and Company Profile (Descriptive Data).
- HTTP Request (StockNews Sentiment): Fetches Daily Sentiment Scores (Sentiment Data).
- HTTP Request (Finnhub Insider): Fetches Insider Buy/Sell Data (Risk Signal).

**III. DATA ENGINEERING AND SYNTHESIS (CUSTOM LOGIC)**

The raw API outputs are cleansed, summarized, and merged into the Agent's working memory.

- 8 x Code Nodes (Parallel)
  - Action: These separate Code Nodes run in parallel to normalize and summarize the raw JSON from the 8 HTTP Requests. For example, the "Insider" code node extracts only the top 5 trades and formats them into a simple text summary.
- Node: Merge
  - Action: Acts as the Synchronization Layer. It waits until all 8 parallel Code Nodes have successfully outputted their sanitized summaries before proceeding.

- Code Node (Consolidation)
  - Action: Collects the 8 clean summaries from the Merge node and combines them into one single, massive, structured Markdown string. This string is the Synthesized In-Context Memory for the LLM.

**IV. LLM REASONING AND DELIVERY (THE AGENT'S BRAIN)**

- Code Node (Prompt Orchestration)
  - Action: Defines the Agent's thought process. It injects the Synthesized Memory into the final LLM Prompt and outlines the multi-step Reasoning Chain (e.g., "Assess Liquidity," "Identify Risks").
- Node: Message a Model (OpenAI/Claude)
  - Action: The LLM Brain executes the Reasoning Chain on the provided data, generating a final, comprehensive, structured investment report.
- Node: Send Email
  - Action: Takes the final text output from the LLM and delivers it to the user's email address (retrieved from the initial Webhook context), closing the loop.
---
## Frontend (GitHub Pages)
Made the frontend using ChatGPT model 5 and DeepSeek using the following prompt:
```
'Build a responsive Stock Insight AI Agent web app using:

Requirements:

Form Fields (with HTML5 validation):
Required:
	‚Ä¢	Stock Ticker (text input, uppercase, 1‚Äì5 characters)
	‚Ä¢	Email Address (email input, must be valid format)

API Integration:
	‚Ä¢	POST JSON to https://armaanwadhwa09.app.n8n.cloud/webhook/run_stock_insight
	‚Ä¢	Headers: { ‚ÄúContent-Type‚Äù: ‚Äúapplication/json‚Äù }
	‚Ä¢	Payload Example:
{
‚Äúticker‚Äù: ‚ÄúAAPL‚Äù,
‚Äúemail‚Äù: ‚Äúuser@example.com‚Äù
}
	‚Ä¢	Handle 4xx/5xx errors with clear user alerts
	‚Ä¢	Show retry option if request fails

UI/UX:
	‚Ä¢	Clean, minimal, finance-style theme using shadcn/ui
  ```
The user interface is a clean, responsive web form generated via AI prompt engineering and hosted on GitHub Pages for fast, reliable static site delivery. 
